apiVersion: apps/v1
kind: Deployment
metadata:
  name: pubsub-publisher
spec:
  replicas: 2
  selector:
    matchLabels:
      app: pubsub-publisher
  template:
    metadata:
      labels:
        app: pubsub-publisher
    spec:
      containers:
      - name: pubsub-publisher
        image: pubsub-publisher:latest
        env:
        - name: GOOGLE_APPLICATION_CREDENTIALS
          value: /app/data-pipleine-keys.json
        volumeMounts:
        - mountPath: /app
          name: gcp-credentials
      volumes:
      - name: gcp-credentials
        secret:
          secretName: gcp-keyfile
---
apiVersion: v1
kind: Secret
metadata:
  name: gcp-keyfile
type: Opaque
data:
  data-pipleine-keys.json: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibnRoLXN1cHJzdGF0ZS00Mzg2MTktYzkiLAogICJwcml2YXRlX2tleV9pZCI6ICIxYTkyMzhiODc5MjA1M2RjNjE2Yzc2M2M0OWNiYTJkOGFhNTZiMDAxIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUUN5RGMzMGV1NHZGS2dYXG5QTnVuV3h0MVFIaGJ3ZW5yd2Q5aWxUYnpNeUc1Ymp3MUFqOTRkaUoySHpwK2tMaSswdUw3RVJMOEFRS3dzREdGXG5VK2hSaTljMks0YldTbEVoelUwSUdDejQ0SkFQTDJGSzVZQ3ZBZk00Zmplb1hjMGwzRDIrc3BqRFF4MjYrZFRnXG5kVlNFSWl4cWJvQUVXUjU5cTZmcjhlZUpGNVlrOHJDd2JKNWpEMXlzTytUdzhab3M5N2FwanF5NzdnVjB5eDVFXG4ydk1EdFF3dEFSenNzSVpRZHV1UEF6QTQ4UlJWTi9iUG5jZGFzUTZWU21PcGo1Rys0N29Yc212UllEV1RXUXBJXG5YeE5wejQxZTArQVlhSmw5R283eUlpOXNIcnV3NjRVOFV5R09hUVJnK3JYWkVSTG1hMzd6cmhxbng1TTY0QlI1XG5hWXNEUXU3ekFnTUJBQUVDZ2dFQU14VzQySU1Jb1dObzBybjRQMnpwVk51NWJJSVhUamZpa3BOREg4VzAwRkhyXG5YajRWM2Nidkhqclplb1NsTE1LdXN0LzBOVzlJeVU3VDltL2JnTUlCYmg1UTRseVNLSU9SclZmYVYxRitvNHl4XG5lbDZjYkJuQUlaNDg4OFp0M0lYekJTcVNuN3M2NVhGV2ZVdk1ndGlYSzdZbWJwanZJWmxGWlhHVFA0Y1A0ZXR3XG5VS2pLT3oxQ2lFekNEN3lWaFNJSXY2RnpzVWZjTndTc2hvbzhpTm53MlhvNzhURmk4ZFBTbmRZOWJoR1pwVVdpXG5wOERLeHZEVlVPR0kxdWpoQmVhRHlLL0FieXFHenJhcUtWNVhzdE1rdHc2eS9ieGlEUDd4dHpKV2lsVTEvMm43XG5uQ2lNT2dqR1pTTGtNRTBzczNzbmkvV1Nlb1JkcndwOUFNSy96SW1wSVFLQmdRRHMxbDJMZmYxdCtzVGhQL0xLXG5uNWVySmJjeFdlaHlMY0VrUmI5aElrVkxUOWVITGt6K0cycVZwUUU1eFczRlNZa0hmcWM4aUNHOEk2cnUvQ3p4XG5jS2NwZkJSWllBWDNGcmhIUmE4bGhOUVlqQkRheUlGUWMzcnhPMkpWM1dkVmR5L29rdHIrUXRRSDBxQlhVaEk5XG5yU0hHQXZYbkpnM0t2WGJta2dob1Q3UHNNUUtCZ1FEQWRkb25oVm5aWU54dEw2VS9zQ0JYdkVsQndVQUgzUFFlXG5DRGdoL2hwWi9BTTJhNXNsbDRxS0NVOW1lODNRS0RCaXc4L1QrbzFOdGJMN3Q0ZzdOK2FoMnV0U01FbWwzKzJpXG5CWEcxWUgrUlJvenFLSDg2M0FBTjBRMTFRdW1OU3FnSWtrUjIydkpCaXpEQ0FpYUJySlNhak9oUFk0UTRPSzVHXG5LWDhibXFvWVl3S0JnUURPdkFSbCtqRlphamVuZzhHMG00Q3lGYmNHYmp2WVJ4WThTbUhYTVNvWnBuVTFlL1liXG5MZVZwQU9MRUFoRmkwR0M3MlJPMFpBUkdqVC90WXRUOFlHQ2Fkc1B3akVCSXdsMVRZWUdVbDVEb2FJTmg1dm55XG5Od3VQUFU0R004QzZ1dEpvQ3FEOHAyc2I5UUNmbUhWeHZ3b25KWGh2TUNtRDJzVEtXWmpiTFErYVVRS0JnUUNzXG5uc2ZOWExqSzFTcS9yOVZhZTBGM0Q4VHcra0RSREtmVDYvRlU0OUdFMWhtWGpRbzV2R01oRGRxdWcrcUVnaGRyXG43azhReFJCS0crZHVDQjVqWnU4d1N1ZDM3eUdQYW5wOE1ML2RPN0VQZnlUU3ZRSG9xL3hNYUMzVzkrMzhzWEpuXG5SYkdzblJKZUlWYlpIQTZuamtBM0lwMFczNTV1d3IvazVFRkNaQVdlR3dLQmdHQ1ZLVnV6NHRHQzFTdVIwdkh6XG5FaXZsVTVZRmZweTBjQUg2dHBJaEFmM2Z5Ryt6cmoxcTJTUkJpd2ZDS0V5RWcvZGhQZ3JwQ1E4cWd6a292c2VnXG4wR1lIbUNzYmp2a1A1MnFvTUY2V3VPcFJkRHlIWXlHOU4xNjBhdXUxWEZsNEc4cFhKWmdHdmdyakl6T1hiemJhXG5hUFBHa0RWa2xUT2IxVW1IcWwyQzBNWGNcbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJkYXRhcGlwZWxpbmVAbnRoLXN1cHJzdGF0ZS00Mzg2MTktYzkuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJjbGllbnRfaWQiOiAiMTA1MzMwMjk4OTMzMzI5OTAyOTIxIiwKICAiYXV0aF91cmkiOiAiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1dGgyL2F1dGgiLAogICJ0b2tlbl91cmkiOiAiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4iLAogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwKICAiY2xpZW50X3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vcm9ib3QvdjEvbWV0YWRhdGEveDUwOS9kYXRhcGlwZWxpbmUlNDBudGgtc3VwcnN0YXRlLTQzODYxOS1jOS5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgInVuaXZlcnNlX2RvbWFpbiI6ICJnb29nbGVhcGlzLmNvbSIKfQo=
